---
- name: Configure fabric node
  hosts: apic
  connection: local
  gather_facts: no

  tasks:
  - name: Get facts from XLSX file
    xls_to_facts:
      src: ../ACI_Deployment_Template.xlsx

  - name: Add/Delete a Fabric node
    aci_fabric_node:
      hostname: "{{ inventory_hostname }}"
      username: "{{ username }}"
      password: "{{ password }}"
      validate_certs: no
      role: "{{  item.Device_Type }}"
      description: "{{ item.Device_Purpose }}"
      serial: "{{ item.Serial_Number }}"
      node_id: "{{ item.Node_ID }}"
      switch: "{{ item.Policy_Name }}"
      state: "{{ item.State }}"
    with_items: "{{ spreadsheet_Fabric_Node}}"
