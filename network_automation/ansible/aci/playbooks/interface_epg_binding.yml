---
- name: Deploy Interface in EPG
  hosts: apic
  connection: local
  gather_facts: no

  tasks:
  - name: Get facts from XLSX file
    xls_to_facts:
      src: ../ACI_Deployment_Template.xlsx

  - name: Add a new static interface binding to epg
    aci_static_binding_to_epg:
      hostname: "{{ inventory_hostname }}"
      username: "{{ username }}"
      password: "{{ password }}"
      validate_certs: no
      tenant: "{{ item.Tenant }}"
      ap: "{{ item.AP }}"
      epg: "{{ item.EPG }}"
      encap_id: "{{ item.VLAN }}"
      interface_mode: "{{ item.Interface_Mode }}"
      interface_type: "{{ item.Interface_Type }}"
      # interface: "{{ item.Interface_Policy_GP }}"
      interface: "{{ item.Interface }}"
      leafs: "{{ item.Leafs }}"
      pod_id: "{{ item.Pod_ID }}"
      deploy_immediacy: immediate
      state: present
    when: item.Interface_Type != "vpc"
    with_items: "{{ spreadsheet_Interface_EPG_Binding }}"

  - name: Add a new static interface binding to epg
    aci_static_binding_to_epg:
      hostname: "{{ inventory_hostname }}"
      username: "{{ username }}"
      password: "{{ password }}"
      validate_certs: no
      tenant: "{{ item.Tenant }}"
      ap: "{{ item.AP }}"
      epg: "{{ item.EPG }}"
      encap_id: "{{ item.VLAN }}"
      interface_mode: "{{ item.Interface_Mode }}"
      interface_type: "{{ item.Interface_Type }}"
      interface: "{{ item.Interface_Policy_GP }}"
      # interface: "{{ item.Interface }}"
      leafs: "{{ item.Leafs }}"
      pod_id: "{{ item.Pod_ID }}"
      deploy_immediacy: immediate
      state: present
    when: item.Interface_Type == "vpc"
    with_items: "{{ spreadsheet_Interface_EPG_Binding }}"
